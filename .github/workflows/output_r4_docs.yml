name: output_r4_docs

on:
  push:
    branches:
      - main
    paths:
      - './dist/**.md'
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    name: output_r4_docs
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 1   
      - name: make pdf
        uses: docker://ghcr.io/ncukondo/pandoc-latex-ja
        with:
          args: '-V classoption="pandoc" -V documentclass=bxjsarticle --pdf-engine=xelatex --filter=pandoc-crossref ./dist/r4.md -o ./dist/r4.pdf'       
      - name: make docx
        uses: docker://ghcr.io/ncukondo/pandoc-latex-ja
        with:
          args: './dist/r4_to_edit.md -o ./dist/r4_to_edit.docx'       
      - name: commit & push
        run: |
          git add -N . # 新規ファイルを含める
          if ! git diff --exit-code --quiet
          then
            echo change ditected update reposistory
            git config user.name github-actions
            git config user.email github-actions@github.com
            git add .
            git commit -m "Updated from Google Sheet"
            git push
          else
            echo no change
          fi
